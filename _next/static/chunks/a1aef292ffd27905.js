(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,40982,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(18566),r=e.i(22016);function l(){let e=(0,s.useRouter)(),[l,n]=(0,a.useState)([]),[i,d]=(0,a.useState)({total:0,remaining:0,won:0}),[c,o]=(0,a.useState)(!0),[x,m]=(0,a.useState)(!1),[h,p]=(0,a.useState)(null),[b,g]=(0,a.useState)(!1),[y,j]=(0,a.useState)(null),[u,N]=(0,a.useState)([]),f="https://backend.vibemakers.kr";(0,a.useEffect)(()=>{if(!localStorage.getItem("admin_token"))return void e.push("/admin/login")},[e]);let v=(0,a.useCallback)(async()=>{let e=localStorage.getItem("admin_token");if(e){o(!0);try{let t=await fetch(`${f}/api/admin/lottery/participants`,{headers:{"x-admin-token":e}});if(t.ok){let e=await t.json();n(e.data.participants||[]),d(e.data.stats||{total:0,remaining:0,won:0});let a=(e.data.participants||[]).filter(e=>e.lotteryWon).map(e=>({id:e.id,name:e.name,phoneLast4:e.phoneLast4,lotteryNumber:e.lotteryNumber}));N(a)}}catch(e){console.error("참가자 로딩 실패:",e)}finally{o(!1)}}},[f]);(0,a.useEffect)(()=>{v()},[v]);let w=async()=>{let e=localStorage.getItem("admin_token");if(!e)return;m(!0),g(!0),p(null);let t=l.filter(e=>!e.lotteryWon);if(0===t.length){alert("추첨 가능한 대상자가 없습니다."),m(!1),g(!1);return}let a=0,s=setInterval(()=>{let r=Math.floor(Math.random()*t.length);j(t[r].lotteryNumber),++a>=20&&(clearInterval(s),k(e))},100)},k=async e=>{try{let t=await fetch(`${f}/api/admin/lottery/draw`,{method:"POST",headers:{"x-admin-token":e,"Content-Type":"application/json"},body:JSON.stringify({excludeWinners:!0})});if(t.ok){let e=(await t.json()).data.winner;j(e.lotteryNumber),setTimeout(()=>{p(e),N(t=>[...t,e]),d(e=>({...e,remaining:e.remaining-1,won:e.won+1})),n(t=>t.map(t=>t.id===e.id?{...t,lotteryWon:!0}:t)),g(!1)},500)}else{let e=await t.json();alert(e.error?.message||"추첨에 실패했습니다."),g(!1)}}catch(e){console.error("추첨 실패:",e),alert("추첨에 실패했습니다."),g(!1)}finally{m(!1)}},S=async()=>{if(!confirm("모든 당첨 기록을 초기화하시겠습니까?"))return;let e=localStorage.getItem("admin_token");if(e)try{(await fetch(`${f}/api/admin/lottery/reset`,{method:"POST",headers:{"x-admin-token":e}})).ok&&(N([]),p(null),v())}catch(e){console.error("초기화 실패:",e)}};return c?(0,t.jsx)("div",{className:"min-h-[100dvh] bg-gray-900 flex items-center justify-center",children:(0,t.jsx)("div",{className:"text-white",children:"로딩 중..."})}):(0,t.jsxs)("div",{className:"min-h-[100dvh] bg-gray-900 text-white",children:[(0,t.jsx)("div",{className:"bg-gray-800 border-b border-gray-700",children:(0,t.jsx)("div",{className:"container mx-auto px-4 py-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(r.default,{href:"/admin",className:"text-gray-400 hover:text-white text-sm",children:"← 관리자"}),(0,t.jsx)("h1",{className:"text-xl font-bold",children:"경품 추첨"})]}),(0,t.jsx)("button",{onClick:S,className:"px-3 py-1 text-sm text-gray-400 hover:text-red-400 transition",children:"초기화"})]})})}),(0,t.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-8",children:[(0,t.jsxs)("div",{className:"bg-gray-800 rounded-lg p-4 text-center",children:[(0,t.jsx)("div",{className:"text-3xl font-bold text-amber-400",children:i.total}),(0,t.jsx)("div",{className:"text-sm text-gray-400",children:"전체 대상"})]}),(0,t.jsxs)("div",{className:"bg-gray-800 rounded-lg p-4 text-center",children:[(0,t.jsx)("div",{className:"text-3xl font-bold text-green-400",children:i.remaining}),(0,t.jsx)("div",{className:"text-sm text-gray-400",children:"미당첨"})]}),(0,t.jsxs)("div",{className:"bg-gray-800 rounded-lg p-4 text-center",children:[(0,t.jsx)("div",{className:"text-3xl font-bold text-pink-400",children:i.won}),(0,t.jsx)("div",{className:"text-sm text-gray-400",children:"당첨자"})]})]}),(0,t.jsx)("div",{className:"bg-gradient-to-br from-amber-500 via-yellow-500 to-amber-600 rounded-2xl p-8 mb-8 text-center",children:b?(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-amber-900/70 text-sm mb-2",children:"추첨 중..."}),(0,t.jsx)("div",{className:"text-7xl font-bold text-amber-900 tabular-nums animate-pulse",children:String(y||0).padStart(4,"0")})]}):h?(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-amber-900/70 text-sm mb-2",children:"당첨자"}),(0,t.jsx)("div",{className:"text-7xl font-bold text-amber-900 tabular-nums mb-4",children:String(h.lotteryNumber).padStart(4,"0")}),(0,t.jsxs)("div",{className:"bg-white/30 rounded-lg px-6 py-3 inline-block",children:[(0,t.jsx)("p",{className:"text-xl font-bold text-amber-900",children:h.name}),(0,t.jsxs)("p",{className:"text-amber-900/70",children:["전화번호 끝자리: ",h.phoneLast4]})]})]}):(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-amber-900/70 text-sm mb-2",children:"추첨 번호"}),(0,t.jsx)("div",{className:"text-7xl font-bold text-amber-900/30 tabular-nums",children:"----"})]})}),(0,t.jsx)("div",{className:"text-center mb-8",children:(0,t.jsx)("button",{onClick:w,disabled:x||0===i.remaining,className:"px-12 py-4 bg-gradient-to-r from-pink-500 to-rose-500 text-white text-xl font-bold rounded-full hover:from-pink-600 hover:to-rose-600 transition disabled:opacity-50 disabled:cursor-not-allowed shadow-lg",children:x?"추첨 중...":0===i.remaining?"추첨 완료":"추첨하기"})}),u.length>0&&(0,t.jsxs)("div",{className:"bg-gray-800 rounded-lg overflow-hidden",children:[(0,t.jsx)("div",{className:"px-4 py-3 border-b border-gray-700",children:(0,t.jsxs)("h2",{className:"font-semibold",children:["당첨자 목록 (",u.length,"명)"]})}),(0,t.jsx)("div",{className:"divide-y divide-gray-700",children:u.map((e,a)=>(0,t.jsxs)("div",{className:"px-4 py-3 flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("span",{className:"text-gray-500 text-sm w-6",children:a+1}),(0,t.jsx)("span",{className:"font-mono text-amber-400 font-bold",children:String(e.lotteryNumber).padStart(4,"0")}),(0,t.jsx)("span",{children:e.name})]}),(0,t.jsx)("span",{className:"text-gray-500 text-sm",children:e.phoneLast4})]},e.id))})]}),(0,t.jsxs)("details",{className:"mt-8",children:[(0,t.jsxs)("summary",{className:"cursor-pointer text-gray-400 hover:text-white text-sm mb-4",children:["전체 참가자 목록 보기 (",i.total,"명)"]}),(0,t.jsx)("div",{className:"bg-gray-800 rounded-lg overflow-hidden max-h-96 overflow-y-auto",children:(0,t.jsxs)("table",{className:"w-full text-sm",children:[(0,t.jsx)("thead",{className:"bg-gray-700 sticky top-0",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-4 py-2 text-left",children:"번호"}),(0,t.jsx)("th",{className:"px-4 py-2 text-left",children:"이름"}),(0,t.jsx)("th",{className:"px-4 py-2 text-left",children:"전화번호"}),(0,t.jsx)("th",{className:"px-4 py-2 text-center",children:"상태"})]})}),(0,t.jsx)("tbody",{className:"divide-y divide-gray-700",children:l.map(e=>(0,t.jsxs)("tr",{className:e.lotteryWon?"bg-pink-900/20":"",children:[(0,t.jsx)("td",{className:"px-4 py-2 font-mono text-amber-400",children:String(e.lotteryNumber).padStart(4,"0")}),(0,t.jsx)("td",{className:"px-4 py-2",children:e.name}),(0,t.jsx)("td",{className:"px-4 py-2 text-gray-400",children:e.phoneLast4}),(0,t.jsx)("td",{className:"px-4 py-2 text-center",children:e.lotteryWon?(0,t.jsx)("span",{className:"px-2 py-0.5 bg-pink-500/20 text-pink-400 text-xs rounded",children:"당첨"}):(0,t.jsx)("span",{className:"text-gray-500 text-xs",children:"-"})})]},e.id))})]})})]})]})]})}e.s(["default",()=>l])}]);